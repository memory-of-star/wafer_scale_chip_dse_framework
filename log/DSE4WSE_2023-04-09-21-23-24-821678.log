(DEBUG) 2023-04-09 21:23:24,821 [logger.py:40] logger init.
(INFO) 2023-04-09 21:23:24,822 [logger.py:42] Logfile /home/chenyiqi/wafer_scale_chip_dse_framework/log/DSE4WSE_2023-04-09-21-23-24-821678.log
(INFO) 2023-04-09 21:23:28,584 [api1.py:116] Design point: {'core_buffer_size': 32, 'core_buffer_bw': 128, 'core_mac_num': 4, 'core_noc_bw': 32, 'core_noc_vc': 4, 'core_noc_buffer_size': 4, 'reticle_bw': 1, 'core_array_h': 8, 'core_array_w': 8, 'wafer_mem_bw': 900, 'reticle_array_h': 51, 'reticle_array_w': 67}
(INFO) 2023-04-09 21:23:28,584 [api1.py:117] Model parameters: {'attention_heads': 24, 'hidden_size': 2304, 'sequence_length': 2048, 'number_of_layers': 24, 'mini_batch_size': 512, 'micro_batch_size': 212, 'data_parallel_size': 4, 'model_parallel_size': 8, 'tensor_parallel_size': 1, 'num_reticle_per_pipeline_stage': 400}
(INFO) 2023-04-09 21:23:28,630 [wse_attn.py:424] Calculating training wse utilization of attention module
(DEBUG) 2023-04-09 21:23:37,662 [lp_solver.py:185] Profiling resource utilization for lp solver
(DEBUG) 2023-04-09 21:23:39,631 [lp_solver.py:235] Average compute util: 4.45%
(DEBUG) 2023-04-09 21:23:39,631 [lp_solver.py:236] Maximum compute util: 4.75%
(DEBUG) 2023-04-09 21:23:39,632 [lp_solver.py:237] Average inter reticle bandwidth util: 15.36%
(DEBUG) 2023-04-09 21:23:39,633 [lp_solver.py:238] Maximum inter reticle bandwidth util: 100.00%
(DEBUG) 2023-04-09 21:23:39,633 [lp_solver.py:239] Average DRAM bandwidth util: 0.09%
(DEBUG) 2023-04-09 21:23:39,633 [lp_solver.py:240] Maximum DRAM bandwidth util: 0.19%
(DEBUG) 2023-04-09 21:23:42,338 [lp_solver.py:185] Profiling resource utilization for lp solver
(DEBUG) 2023-04-09 21:23:44,375 [lp_solver.py:235] Average compute util: 7.50%
(DEBUG) 2023-04-09 21:23:44,376 [lp_solver.py:236] Maximum compute util: 8.00%
(DEBUG) 2023-04-09 21:23:44,377 [lp_solver.py:237] Average inter reticle bandwidth util: 17.24%
(DEBUG) 2023-04-09 21:23:44,377 [lp_solver.py:238] Maximum inter reticle bandwidth util: 100.00%
(DEBUG) 2023-04-09 21:23:44,378 [lp_solver.py:239] Average DRAM bandwidth util: 0.10%
(DEBUG) 2023-04-09 21:23:44,378 [lp_solver.py:240] Maximum DRAM bandwidth util: 0.21%
(INFO) 2023-04-09 21:23:44,381 [wse_attn.py:445] Summary for checking time utilization proportion:
(INFO) 2023-04-09 21:23:44,381 [wse_attn.py:447] compute              :           11163 ms (2.05%)
(INFO) 2023-04-09 21:23:44,381 [wse_attn.py:447] inter_reticle        :          163323 ms (30.00%)
(INFO) 2023-04-09 21:23:44,382 [wse_attn.py:447] inter_wafer          :               5 ms (0.00%)
(INFO) 2023-04-09 21:23:44,382 [wse_attn.py:447] idle                 :          381095 ms (70.00%)
(INFO) 2023-04-09 21:23:44,382 [api1.py:131] training_utilization: 0.02050571596418194
(INFO) 2023-04-09 21:23:44,508 [api1.py:116] Design point: {'core_buffer_size': 32, 'core_buffer_bw': 128, 'core_mac_num': 4, 'core_noc_bw': 32, 'core_noc_vc': 4, 'core_noc_buffer_size': 4, 'reticle_bw': 1, 'core_array_h': 8, 'core_array_w': 8, 'wafer_mem_bw': 900, 'reticle_array_h': 51, 'reticle_array_w': 67}
(INFO) 2023-04-09 21:23:44,509 [api1.py:117] Model parameters: {'attention_heads': 24, 'hidden_size': 2304, 'sequence_length': 2048, 'number_of_layers': 24, 'mini_batch_size': 512, 'micro_batch_size': 415, 'data_parallel_size': 4, 'model_parallel_size': 2, 'tensor_parallel_size': 24, 'num_reticle_per_pipeline_stage': 248}
(WARNING) 2023-04-09 21:23:44,553 [api1.py:108] Traceback (most recent call last):
  File "/home/chenyiqi/wafer_scale_chip_dse_framework/dse4wse/test/dse/api1.py", line 104, in wrapper
    return func(*args, **kwargs)
  File "/home/chenyiqi/wafer_scale_chip_dse_framework/dse4wse/test/dse/api1.py", line 120, in evaluate_design_point
    evaluator = create_evaluator(wafer_scale_engine, **model_parameters)
  File "/home/chenyiqi/wafer_scale_chip_dse_framework/dse4wse/test/dse/api1.py", line 83, in create_evaluator
    wse_transformer_runner = WseTransformerRunner(
  File "/home/chenyiqi/wafer_scale_chip_dse_framework/dse4wse/dse4wse/model/wse_attn.py", line 495, in __init__
    super().__init__(attention_heads, hidden_size, sequence_length, number_of_layers, micro_batch_size, mini_batch_size, data_parallel_size, model_parallel_size, tensor_parallel_size, wafer_scale_engine, training_config, inter_wafer_bandwidth, zero_dp_os, zero_dp_g, zero_dp_p, zero_r_pa, num_reticle_per_pipeline_stage)
  File "/home/chenyiqi/wafer_scale_chip_dse_framework/dse4wse/dse4wse/model/wse_attn.py", line 91, in __init__
    assert self.num_pipeline_stage_per_wafer >= 1, f"Requiring {tensor_parallel_size * num_reticle_per_pipeline_stage} reticles but only {wafer_scale_engine.reticle_array_height * wafer_scale_engine.reticle_array_width} reticles on the wafer!"
AssertionError: Requiring 5952 reticles but only 3417 reticles on the wafer!

